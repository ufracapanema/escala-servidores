<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestão de Férias Servidores</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        body { background-color: #f8f9fa; font-family: 'Segoe UI', system-ui, sans-serif; }
        
        /* Ajuste de simetria para a barra de pesquisa */
        .search-container { 
            background: white; 
            padding: 25px; 
            border-radius: 8px; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.05); 
            margin-bottom: 30px;
            border: 1px solid #dee2e6;
        }

        .setor-container { margin-bottom: 40px; }
        
        .setor-title { 
            padding: 10px 15px;
            border-radius: 6px;
            color: white;
            font-weight: 600;
            margin-bottom: 20px;
            display: inline-block;
            min-width: 200px;
        }

        /* Padronização do tamanho dos cards */
        .servidor-card { 
            background: white; 
            border: 1px solid #e9ecef;
            border-radius: 8px; 
            height: 100%; /* Faz todos os cards da mesma linha terem a mesma altura */
            padding: 18px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .nome-servidor {
            font-size: 1.05rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 12px;
            border-bottom: 1px solid #f1f1f1;
            padding-bottom: 8px;
        }

        .data-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            font-weight: 700;
            color: #6c757d;
            margin-right: 5px;
        }

        .data-valor {
            font-size: 0.95rem;
            color: #212529;
            font-weight: 500;
        }

        .badge-dias {
            background-color: #212529;
            color: white;
            font-size: 0.8rem;
            padding: 5px 10px;
            border-radius: 20px;
        }
    </style>
</head>
<body>

<div class="container py-5">
    <div class="text-center mb-4">
        <h1 class="fw-bold">Escala de Férias</h1>
        <p class="text-muted">Acompanhamento de períodos por setor</p>
    </div>

    <div class="search-container">
        <div class="input-group">
            <span class="input-group-text bg-light border-end-0"><i class="bi bi-search"></i></span>
            <input type="text" id="inputBusca" class="form-control bg-light border-start-0 shadow-none" placeholder="Digite o nome do servidor ou setor para filtrar...">
        </div>
    </div>

    <div id="painelSetores">
        </div>
</div>

<script>
    const url = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRKegsnxIiUPRWL3KMa9vgqmZJB3hCS9hSavAAYo3FYyOiegdGPoJJQOQ-vGbmumbEsNy2DUFxgDb2c/pub?output=csv";
    
    // Cores fixas para cada setor
    const coresSetores = {
        "Administrativo": "#4e73df",
        "TI": "#1cc88a",
        "RH": "#f6c23e",
        "Financeiro": "#e74a3b",
        "Saúde": "#36b9cc",
        "Educação": "#858796",
        "Geral": "#5a5c69"
    };

    async function carregarDados() {
        try {
            const resposta = await fetch(url + "&t=" + new Date().getTime());
            const texto = await resposta.text();
            const linhas = texto.split(/\r?\n/).filter(l => l.trim() !== "").slice(1);

            const dados = linhas.map(l => {
                const cols = l.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(c => c.replace(/^"|"$/g, '').trim());
                return {
                    nome: cols[0],
                    inicio: cols[1],
                    fim: cols[2],
                    setor: cols[3] || 'Geral',
                    dias: calcularDiferenca(formatarData(cols[1]), formatarData(cols[2])),
                    inicioSort: new Date(formatarData(cols[1]))
                };
            });

            renderizar(dados);

            document.getElementById('inputBusca').addEventListener('input', (e) => {
                const termo = e.target.value.toLowerCase();
                const filtrados = dados.filter(s => 
                    s.nome.toLowerCase().includes(termo) || s.setor.toLowerCase().includes(termo)
                );
                renderizar(filtrados);
            });

        } catch (e) {
            document.getElementById('painelSetores').innerHTML = "Erro ao carregar dados.";
        }
    }

    function formatarData(dStr) {
        const parts = dStr.split('/');
        return `${parts[2]}-${parts[1]}-${parts[0]}`;
    }

    function calcularDiferenca(i, f) {
        const d1 = new Date(i);
        const d2 = new Date(f);
        return Math.ceil(Math.abs(d2 - d1) / (1000 * 60 * 60 * 24)) + 1;
    }

    function renderizar(dados) {
        const container = document.getElementById('painelSetores');
        container.innerHTML = "";

        const agrupados = {};
        dados.forEach(s => {
            if (!agrupados[s.setor]) agrupados[s.setor] = [];
            agrupados[s.setor].push(s);
        });

        Object.keys(agrupados).sort().forEach(setor => {
            const cor = coresSetores[setor] || coresSetores["Geral"];
            const servidores = agrupados[setor].sort((a,b) => a.inicioSort - b.inicioSort);

            let html = `
                <div class="setor-container">
                    <h5 class="setor-title" style="background-color: ${cor}">${setor}</h5>
                    <div class="row g-3">
            `;

            servidores.forEach(s => {
                html += `
                    <div class="col-xl-3 col-lg-4 col-md-6">
                        <div class="servidor-card">
                            <div class="nome-servidor">${s.nome}</div>
                            <div class="mb-2">
                                <span class="data-label">Início:</span><span class="data-valor">${s.inicio}</span>
                            </div>
                            <div class="mb-3">
                                <span class="data-label">Fim:</span><span class="data-valor">${s.fim}</span>
                            </div>
                            <div class="mt-auto pt-2 border-top d-flex justify-content-between align-items-center">
                                <small class="text-muted">Duração:</small>
                                <span class="badge-dias">${s.dias} dias</span>
                            </div>
                        </div>
                    </div>
                `;
            });

            html += `</div></div>`;
            container.innerHTML += html;
        });
    }

    carregarDados();
</script>

</body>
</html>
